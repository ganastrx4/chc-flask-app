<!DOCTYPE html>
<html>
<head>
  <title>CharlyCoin Login</title>
  <script src="https://unpkg.com/@worldcoin/idkit@1.1.0/dist/index.umd.js"></script>
</head>
<body>
  <h2>Autenticación con World ID</h2>
  <div id="world-id-button"></div>

  <script>
    const signal = 'user_login_' + Date.now(); // señal única por sesión

    new window.WorldIDWidget.WorldIDWidget({
      action_id: "app_7686f9027d3e3c0b53d987a3caf1e111",
      signal: signal,
      enableTelemetry: true,
      app_name: "CharlyCoin",
      theme: "light",
      containerId: "world-id-button",
      onSuccess: async (proofData) => {
        console.log("Prueba recibida:", proofData);
        // Enviamos la prueba al backend para verificarla
        const response = await fetch('/verify', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ ...proofData, signal })
        });
        const result = await response.json();
        alert("Resultado de verificación: " + result.status);
      },
      onError: (error) => {
        console.error("Error en verificación:", error);
      }
    });
  </script>
</body>
</html>
