<!DOCTYPE html>
<html>
<head>
  <title>CharlyCoin Login</title>
  <script src="https://cdn.worldcoin.org/idkit.js"></script>
</head>
<body>
  <h1>Iniciar sesión con World ID</h1>

  <div id="world-id"></div>

  <script>
    const signal = "login_" + Date.now();

    new WorldIDWidget({
      action_id: "app_7686f9027d3e3c0b53d987a3caf1e111",
      signal: signal,
      enable_telemetry: true,
      container_id: "world-id",
      on_success: (response) => {
        fetch('http://localhost:5000/verify', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            proof: response.proof,
            nullifier_hash: response.nullifier_hash,
            merkle_root: response.merkle_root,
            signal: signal
          })
        })
        .then(res => res.json())
        .then(data => {
          alert(data.success ? "Verificación exitosa!" : "Falló la verificación");
        });
      },
      on_error: (err) => {
        console.error(err);
        alert("Error de autenticación");
      }
    });
  </script>
</body>
</html>
