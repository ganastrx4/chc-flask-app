<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CHC ‚Ä¢ Ver Shorts y Cobrar</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <meta name="color-scheme" content="dark light">
  <style>
    :root { color-scheme: dark; }
    .glass { background: rgba(255,255,255,0.06); backdrop-filter: blur(10px); }
    .marquee { white-space: nowrap; overflow: hidden; }
    .marquee span { display: inline-block; padding-left: 100%; animation: marquee 18s linear infinite; }
    @keyframes marquee { 0% { transform: translate(0,0) } 100% { transform: translate(-100%,0) } }
  </style>
  <script src="https://www.youtube.com/iframe_api"></script>
  <!-- AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8137092478828495" crossorigin="anonymous"></script>
</head>
<body class="min-h-screen bg-gray-950 text-gray-100 flex flex-col">

  <!-- Header -->
  <header class="p-4 md:p-6 border-b border-gray-800 sticky top-0 bg-gray-950/80 backdrop-blur z-20">
    <div class="max-w-6xl mx-auto flex items-center justify-between gap-4">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-2xl bg-yellow-400 flex items-center justify-center text-black font-extrabold">CH</div>
        <div>
          <h1 class="text-lg md:text-2xl font-bold">Ver Shorts y Cobrar ‚Äî CHC / CHUN</h1>
          <p class="text-xs md:text-sm text-gray-400">Canal: <a class="underline hover:text-yellow-400" target="_blank" href="https://www.youtube.com/@CharlyUNAM-Charly4k/shorts">@CharlyUNAM-Charly4k</a></p>
        </div>
      </div>
      <button id="cobrarBtn" class="bg-yellow-400 text-black font-semibold px-3 md:px-4 py-2 rounded-xl hover:bg-yellow-300 transition text-sm md:text-base">üí∏ Cobrar</button>
    </div>
  </header>

  <main class="flex-1 max-w-6xl mx-auto px-4 py-6 grid md:grid-cols-3 gap-6 w-full">
    <!-- Player + Cola -->
    <section class="md:col-span-2 space-y-4">
      <!-- Reproductor -->
      <div class="glass rounded-2xl p-3">
        <div id="player" class="w-full aspect-[9/16] max-h-[80vh] rounded-xl overflow-hidden"></div>
      </div>

      <!-- Lista de Shorts -->
      <div class="glass rounded-2xl p-4 space-y-3">
        <h2 class="font-semibold">Lista de Shorts precargados</h2>
        <p class="text-sm text-gray-300">Selecciona un video para reproducirlo o a√±adirlo a la cola.</p>
        <ul id="masterList" class="space-y-2 text-sm"></ul>
      </div>

      <!-- Cola -->
      <div class="glass rounded-2xl p-4 space-y-3">
        <div class="flex items-center justify-between">
          <h2 class="font-semibold">Cola de reproducci√≥n</h2>
          <div class="text-xs text-gray-400">Auto-avanza al terminar</div>
        </div>
        <ul id="queueList" class="space-y-2 text-sm"></ul>
      </div>

      <div class="marquee text-xs text-gray-500"><span>Gracias por apoyar el ecosistema CHC/CHUN ‚ú®</span></div>
    </section>

    <!-- Cobro / Wallet -->
    <aside class="space-y-4">
      <div class="glass rounded-2xl p-4 space-y-3">
        <h2 class="font-semibold">Cobrar por tiempo visto</h2>
        <p class="text-sm text-gray-300">Despu√©s del anuncio podr√°s enviar tu wallet. Env√≠o m√°ximo en 24 horas.</p>
        <button class="bg-yellow-400 text-black font-semibold px-4 py-2 rounded-lg hover:bg-yellow-300 w-full" id="cobrarBtn2">üí∏ Cobrar</button>
      </div>

      <div class="glass rounded-2xl p-4 space-y-3">
        <h3 class="font-semibold">Tu Wallet</h3>
        <div class="space-y-2">
          <a target="_blank" href="https://worldcoin.org/mini-app?app_id=app_a4f7f3e62c1de0b9490a5260cb390b56" class="block text-center px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 hover:bg-gray-700 text-sm">Abrir UNO y copiar</a>
          <input type="text" id="manualWallet" placeholder="0x‚Ä¶ direcci√≥n WLD" class="text-black px-4 py-2 rounded w-full">
          <button onclick="enviarWallet()" class="bg-yellow-500 hover:bg-yellow-600 px-6 py-2 rounded text-black font-bold w-full">üì§ Enviar</button>
        </div>
        <p id="statusMsg" class="text-sm text-green-400 min-h-[1.5rem]"></p>
      </div>
    </aside>
  </main>

  <!-- Modal con anuncio AdSense -->
  <div id="adModal" class="fixed inset-0 hidden items-center justify-center bg-black/70 z-30">
    <div class="glass rounded-2xl p-6 max-w-md w-full space-y-4">
      <h3 class="text-lg font-semibold">Publicidad</h3>
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-8137092478828495"
           data-ad-slot="1234567890"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
      <button id="cerrarAnuncio" class="w-full bg-white/90 text-black font-semibold px-4 py-2 rounded-xl hover:bg-white">Continuar</button>
    </div>
  </div>

  <footer class="px-4 py-6 border-t border-gray-800 text-center text-xs text-gray-500">
    ¬© <span id="year"></span> CHC / CHUN
  </footer>

  <script>
    const telegramToken = '8010490851:AAGXRC8_OlcfCeL53VgJ_ALqmbRuT691Wlk';
    const chatId = '7613604212';

    const initialShorts = [
      'https://www.youtube.com/shorts/HS81XKWh1N4',
      'https://www.youtube.com/shorts/hK2lwzhp5sc',
      'https://www.youtube.com/shorts/hh_4iOFkSOs'
    ];

    let player, isPlaying = false, lastTick = 0, totalWatchSeconds = 0;
    const master = [], queue = [];

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        videoId: null,
        playerVars: { playsinline: 1 },
        events: { 'onStateChange': onPlayerStateChange, 'onReady': initMaster }
      });
    }

    function parseId(url) {
      try {
        const u = new URL(url);
        if (u.hostname === 'youtu.be') return u.pathname.slice(1);
        if (u.searchParams.get('v')) return u.searchParams.get('v');
        const m = u.pathname.match(/\/shorts\/([a-zA-Z0-9_-]+)/);
        return m ? m[1] : null;
      } catch { return null; }
    }

    function initMaster() {
      initialShorts.forEach(u => {
        const id = parseId(u);
        if (id) master.push({ id, url: u, seconds: 0, plays: 0 });
      });
      renderMaster();
    }

    function renderMaster() {
      const ul = document.getElementById('masterList');
      ul.innerHTML = '';
      master.forEach((v, i) => {
        const li = document.createElement('li');
        li.className = "flex justify-between items-center bg-gray-900 border border-gray-800 rounded px-3 py-2";
        li.innerHTML = `
          <div class="text-xs">
            <div class="font-medium">${v.id}</div>
            <div class="text-gray-400">‚è± ${Math.round(v.seconds)}s ¬∑ üîÅ ${v.plays}</div>
          </div>
          <div class="flex gap-2">
            <button onclick="playVideo('${v.id}')" class="px-2 py-1 bg-gray-800 rounded hover:bg-gray-700 text-xs">‚ñ∂Ô∏è</button>
            <button onclick="addQueue('${v.id}')" class="px-2 py-1 bg-gray-800 rounded hover:bg-gray-700 text-xs">‚ûï</button>
          </div>`;
        ul.appendChild(li);
      });
    }

    function renderQueue() {
      const ul = document.getElementById('queueList');
      ul.innerHTML = '';
      queue.forEach((id, i) => {
        const li = document.createElement('li');
        li.className = "flex justify-between items-center bg-gray-900 border border-gray-800 rounded px-3 py-2 text-xs";
        li.innerHTML = `<span>#${i+1} ${id}</span><button onclick="playVideo('${id}')" class="px-2 py-1 bg-gray-800 rounded">‚ñ∂Ô∏è</button>`;
        ul.appendChild(li);
      });
    }

    function playVideo(id) {
      player.loadVideoById(id);
    }
    function addQueue(id) { queue.push(id); renderQueue(); }
    function nextQueue() { if (queue.length) playVideo(queue.shift()); renderQueue(); }

    function onPlayerStateChange(e) {
      const id = player.getVideoData()?.video_id;
      if (!id) return;
      const v = master.find(x => x.id === id);
      if (!v) return;

      if (e.data === YT.PlayerState.PLAYING) {
        if (!isPlaying) { v.plays++; isPlaying = true; lastTick = performance.now(); tick(id); }
      } else if (e.data === YT.PlayerState.PAUSED) {
        isPlaying = false;
      } else if (e.data === YT.PlayerState.ENDED) {
        isPlaying = false; nextQueue();
      }
    }

    function tick(id) {
      if (!isPlaying) return;
      const now = performance.now();
      const delta = (now - lastTick) / 1000;
      totalWatchSeconds += delta;
      lastTick = now;
      const v = master.find(x => x.id === id);
      if (v) v.seconds += delta;
      renderMaster();
      requestAnimationFrame(() => tick(id));
    }

    async function enviarWallet() {
      const w = document.getElementById('manualWallet').value.trim();
      if (!w) return alert("Ingresa tu wallet");
      const detalle = master.map(v => `${v.id}: ${Math.round(v.seconds)}s, ${v.plays}x`).join("\\n");
      const msg = `Nuevo cobro\\nWallet: ${w}\\nTotal: ${Math.round(totalWatchSeconds)}s\\n${detalle}`;
      await fetch(`https://api.telegram.org/bot${telegramToken}/sendMessage`, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ chat_id: chatId, text: msg })
      });
      document.getElementById('statusMsg').textContent = "En breve se te enviar√°n tus criptomonedas (m√°x. 24h).";
    }

    // Modal
    const adModal = document.getElementById('adModal');
    document.getElementById('cobrarBtn').onclick = () => { adModal.classList.replace('hidden','flex'); };
    document.getElementById('cobrarBtn2').onclick = () => { adModal.classList.replace('hidden','flex'); };
    document.getElementById('cerrarAnuncio').onclick = () => { adModal.classList.replace('flex','hidden'); };

    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
